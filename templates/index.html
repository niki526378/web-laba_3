<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>–ü–∞—Ä–∏–∫–º–∞—Ö–µ—Ä—Å–∫–∞—è - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —É—Å–ª—É–≥–∞–º–∏</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <div class="container">
        <h1>–£—Å–ª—É–≥–∏ –ø–∞—Ä–∏–∫–º–∞—Ö–µ—Ä—Å–∫–æ–π</h1>

        <div class="card">
            <h3>–î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—É—é —É—Å–ª—É–≥—É</h3>
            <form action="/add" method="POST" class="add-form">
                <input type="text" name="name" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ —É—Å–ª—É–≥–∏" required>
                <input type="text" name="category" placeholder="–ö–∞—Ç–µ–≥–æ—Ä–∏—è –º–∞—Å—Ç–µ—Ä–∞" required>
                <input type="number" name="duration" placeholder="–ú–∏–Ω." required title="–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å">
                <input type="number" name="price" placeholder="–¶–µ–Ω–∞ (—Ä—É–±)" required>
                <input type="number" name="material_cost" placeholder="–†–∞—Å—Ö–æ–¥–Ω–∏–∫–∏" required>
                <div class="captcha">
                    <label>–ö–∞–ø—á–∞: {{ captcha_q }} = </label>
                    <input type="number" name="captcha_ans" required style="width: 50px;">
                </div>
                <button type="submit" class="btn-add">–î–æ–±–∞–≤–∏—Ç—å –∑–∞–ø–∏—Å—å</button>
            </form>
        </div>

        <hr>

        <table>
            <thead>
                <tr>
                    {% for field in ['id', '–ù–∞–∑–≤–∞–Ω–∏–µ', '–ö–∞—Ç–µ–≥–æ—Ä–∏—è', '–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å (–º–∏–Ω.)', '–¶–µ–Ω–∞ (—Ä—É–±.)', '–†–∞—Å—Ö–æ–¥–Ω–∏–∫–∏ (—Ä—É–±.)'] %}
                    <th>
                        <a href="/?sort_by={{ field }}&order={{ 'desc' if order=='asc' and sort_by==field else 'asc' }}">
                            {{ field | upper }} 
                            {% if sort_by == field %}{{ '‚Üì' if order=='desc' else '‚Üë' }}{% endif %}
                        </a>
                    </th>
                    {% endfor %}
                    <th>–î–µ–π—Å—Ç–≤–∏–µ</th>
                </tr>
            </thead>
            <tbody>
                {% for s in services %}
                <tr>
                    <form action="/update/{{ s.id }}" method="POST">
                        <td>{{ s.id }}</td>
                        <td><input type="text" name="name" value="{{ s.name }}"></td>
                        <td><input type="text" name="category" value="{{ s.category }}"></td>
                        <td><input type="number" name="duration" value="{{ s.duration }}"></td>
                        <td><input type="number" name="price" value="{{ s.price }}"></td>
                        <td><input type="number" name="material_cost" value="{{ s.material_cost }}"></td>
                        <td>
                            <button type="submit" class="btn-save">üíæ</button>
                            <a href="/delete/{{ s.id }}" class="btn-del" onclick="return confirm('–£–¥–∞–ª–∏—Ç—å?')">üóëÔ∏è</a>
                        </td>
                    </form>
                </tr>
                {% endfor %}
            </tbody>
        </table>

        <div class="card stats">
            <h3>–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ —á–∏—Å–ª–æ–≤—ã–º –ø–æ–ª—è–º</h3>
            <div class="stats-grid">
                {% for f, v in stats.items() %}
                <div class="stat-item">
                    <strong>{{ f | capitalize }}:</strong>
                    <span>–ú–∏–Ω: {{ v.min }}</span> | 
                    <span>–ú–∞–∫—Å: {{ v.max }}</span> | 
                    <span>–°—Ä–µ–¥–Ω–µ–µ: {{ v.avg }}</span>
                </div>
                {% endfor %}
            </div>
        </div>

        <p><a href="/api/services" target="_blank">–û—Ç–∫—Ä—ã—Ç—å API (JSON)</a></p>
    </div>
</body>
</html>
